Conditional statements and Expressions add logic to SQL queries

CASE

We can use the CASE statement to only execute SQL code when certain conditions are met
This is very similar to IF/ELSE statements in other programming languages.

There are two main ways to use a CASE statement, either a general CASE or a CASE expression.

Both methods can lead to the same results.

General Syntax

CASE
 WHEN condition1 THEN result1
 WHEN condition2 THEN result2
 ELSE some_other_result
END


Consider a simple table

a
1
2

SELECT * FROM a 

will retrieve all data. 

Using case 

SELECT a,
CASE
WHEN a=1, THEN 'one'
WHEN a=2, THEN 'two'
ELSE 'other' 
END AS label
FROM test;

The resulting output will be

a label
1 one
2 two

Here, we can see, the CASE block is considered as a column and we have an alias name for it. 
Once the Block is 'END', we return back to normal query. 


CASE EXPRESSION
THE CASE expression syntax first evalues an expression then compares thre result with each value in WHEN clauses sequentially.

SYNTAX

CASE expression
WHEN value1 THEN result1
WHEN value2 THEN result2
ELSE some_other_result
END

Note that here in WHEN we do not have conditions. 

CASE expression is used in general to check equality.
WHEN conditions can be used flexibily for all kinds of conditional checks. 


Example

SELECT a,
CASE a
WHEN 1 THEN 'one'
WHEN 2 THEN 'two'
ELSE 'other' 
END AS label
FROM test;


Examples from DB

Customer 1 to 100 are premium
Customer 101 to 200 are plus
Others normal customer.

SELECT customer_id,
CASE
WHEN (customer_id <= 100) THEN 'Premium'
WHEN (customer_id BETWEEN 100 AND 200) THEN 'Plus'
ELSE 'Normal' 
END AS customer_class
FROM customer;

CASE EXPRESSION Example

After a promotion we found customers 2 and 5 are winners. 


SELECT customer_id,
CASE customer_id
WHEN 2 THEN 'Winner'
WHEN 5 THEN 'Second Place'
ELSE 'Better Luck Next Time'
END AS results
FROM customer;


Find the sum of bargain, normal and premium rentals

We can group these in GROUP BY. But the result will not be as shown in this expression. 

SELECT
SUM(CASE rental_rate
WHEN 0.99 THEN 1
ELSE 0
END) AS bargains,
SUM(CASE rental_rate
WHEN 2.99 THEN 1
ELSE 0
END) AS normal,
SUM(CASE rental_rate
WHEN 4.99 THEN 1
ELSE 0
END) AS premium
FROM film;